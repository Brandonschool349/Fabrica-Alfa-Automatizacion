<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>F√°brica Alfa ‚Äî Dashboard SaaS (Neumorphism Oscuro)</title>

  <!-- Bootstrap (utilidades) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Estilos (externo: style.css) -->
  <link rel="stylesheet" href="/web/style.css">
  <link rel="icon" type="image/x-icon" href="/web/favicon.ico">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app-root">
    <!-- SIDEBAR SaaS -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-top">
        <div class="brand">
          <img src="/web/Fabrica Alfa logo.png" class="logo-img" alt="F√°brica Alfa">
          <div class="brand-text">
            <div class="title">F√°brica Alfa</div>
            <div class="subtitle">Control & Anal√≠tica</div>
          </div>
        </div>

        <div class="search-wrap">
          <input id="sidebarSearch" class="form-control" placeholder="Buscar..." />
        </div>

        <nav class="nav-list" role="navigation" aria-label="main">
          <button id="themeToggle" class="btn btn-outline-light">‚òÄÔ∏è Modo claro</button>
          <button class="nav-item active" data-view="dashboard"><span class="nav-ico">üè†</span><span class="nav-label">Dashboard</span></button>
          <button class="nav-item" data-view="estadisticas"><span class="nav-ico">üìä</span><span class="nav-label">Estad√≠sticas</span></button>
          <button class="nav-item" data-view="modelos"><span class="nav-ico">üßÆ</span><span class="nav-label">Modelos Prob.</span></button>
          <button class="nav-item" data-view="produccion"><span class="nav-ico">üè≠</span><span class="nav-label">Control Producci√≥n</span></button>
          <button class="nav-item" data-view="operario"><span class="nav-ico">üë∑</span><span class="nav-label">√Årea Operario</span></button>
        </nav>
      </div>

      <!-- <div class="sidebar-preview">
        <div class="muted small">Preview (screenshot)</div>
        <img src="./mnt/data/db883e4d-50fb-45de-acfb-6025188e3e99.png" alt="preview" class="preview-img" />
      </div> -->

      <div class="sidebar-bottom">
        <div class="user-info">
          <div class="small-muted">Usuario</div>
          <div id="userNameDisplay" class="user-name">‚Äî</div>
        </div>
        <div class="sidebar-actions">
          <button id="btnUpload" onclick="document.getElementById('fileInput').click();" 
        class="btn btn-sm btn-outline-light" title="Subir datos">üìÅ Subir</button>
          <button id="btnLogout" class="btn btn-sm btn-danger" title="Cerrar sesi√≥n">Cerrar sesi√≥n</button>
        </div>
        <div class="api-status muted">API: <span id="apiStatus">desconocida</span></div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <!-- Topbar -->
      <header class="topbar">
        <div class="top-left">
          <h4>Panel de Control ‚Äî <span class="accent">F√°brica Alfa</span></h4>
          <div class="muted">Neumorphism oscuro ¬∑ SaaS moderno</div>
        </div>
        <div class="top-right">
          <div id="roleBadge" class="role-badge muted">Sin sesi√≥n</div>
        </div>
      </header>

      <!-- Views container -->
      <section class="views">

        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="view-pane active">
          <div class="grid grid-2-1">
            <!-- LEFT: KPIs + upload -->
            <div>
              <div class="card kpi-card">
                <div class="kpi-row">
                  <div>
                    <div class="muted">Registros cargados</div>
                    <div id="kpiRecords" class="kpi-value">0</div>
                  </div>
                  <div>
                    <div class="muted">Columnas detectadas</div>
                    <div id="kpiCols" class="kpi-value">‚Äî</div>
                  </div>
                </div>
                <div class="mt-3">
                  <label class="muted small">Cargar base (CSV / XLSX)</label>
                  <div style="display:flex; gap:8px; margin-top:8px;">
                    <input id="fileInput" type="file" accept=".csv,.xlsx" class="form-control">
                    <button id="uploadBtn" class="btn btn-primary">Subir</button>
                    <button id="clearBtn" class="btn btn-outline-light">Limpiar</button>
                  </div>
                  <div id="uploadMsg" class="muted" style="margin-top:8px;">Esperando archivo...</div>
                </div>
              </div>

              <div class="card metrics-card">
                <h5>Medidas r√°pidas</h5>
                <div class="form-row" style="margin-top:8px;">
                  <select id="selectQuick" class="form-select"></select>
                  <button id="btnQuickCalc" class="btn btn-primary">Calcular</button>
                </div>
                <div class="metrics mt-3">
                  <div><div class="muted">Media</div><div id="quickMedia" class="metric">‚Äî</div></div>
                  <div><div class="muted">Mediana</div><div id="quickMediana" class="metric">‚Äî</div></div>
                  <div><div class="muted">Moda</div><div id="quickModa" class="metric">‚Äî</div></div>
                </div>
              </div>

              <div class="card small-card">
                <h6>Resumen</h6>
                <div id="summaryBlock" class="muted">Sin datos.</div>
              </div>
            </div>

            <!-- RIGHT: Charts -->
            <div>
              <div class="card chart-card">
                <h5>Ventas vs Unidades</h5>
                <canvas id="scatterChart"></canvas>
                <div id="scatterMsg" class="muted mt-2">Cargar datos para visualizar.</div>
              </div>

              <div class="card chart-card mt-3">
                <h5>Histograma ‚Äî Unidades</h5>
                <canvas id="histUnidades"></canvas>
                <div id="histMsg" class="muted mt-2">Cargar datos para visualizar.</div>
              </div>
            </div>
          </div>
        </section>

<!-- ESTADISTICAS VIEW -->
<section id="view-estadisticas" class="view-pane hidden">
  <div class="grid grid-3">

    <!-- CARD 1 - Tendencia central -->
    <div class="card">
      <h4>Medidas de tendencia central</h4>
      <select id="selectTend" class="form-select mt-2"></select>
      <div style="display:flex; gap:8px; margin-top:10px;">
        <button id="btnTend" class="btn btn-primary">Calcular</button>
        <button id="btnTendAuto" class="btn btn-outline-light">Auto</button>
      </div>
      <div class="mt-3">
        <div class="muted">Media</div><div id="mediaVal" class="metric">‚Äî</div>
        <div class="muted">Mediana</div><div id="medianaVal" class="metric">‚Äî</div>
        <div class="muted">Moda</div><div id="modaVal" class="metric">‚Äî</div>
      </div>
    </div>

    <!-- CARD 2 - Dispersi√≥n -->
    <div class="card">
      <h4>Medidas de dispersi√≥n</h4>
      <select id="selectDisp" class="form-select mt-2"></select>
      <button id="btnDisp" class="btn btn-warning w-100 mt-3">Calcular</button>
      <div class="mt-3">
        <div class="muted">Desviaci√≥n</div><div id="sdVal" class="metric">‚Äî</div>
        <div class="muted">Varianza</div><div id="varVal" class="metric">‚Äî</div>
        <div class="muted">IQR</div><div id="iqrVal" class="metric">‚Äî</div>
      </div>
    </div>

    <!-- CARD 3 - Probabilidades Binomial -->
    <div class="card">
      <h4>Probabilidades & Tests (Binomial)</h4>

      <div style="display:flex; gap:8px;">
        <input id="binN" type="number" class="form-control" placeholder="n">
        <input id="binP" type="number" class="form-control" step="0.01" placeholder="p">
      </div>

      <button id="btnBinom" class="btn btn-primary w-100 mt-2">Generar Binomial</button>

      <canvas id="chartBinomialStats" class="mt-3"></canvas>
      <div id="probOutputsStats" class="mt-3"></div>
    </div>

    <!-- CARD 4 - Prueba t -->
    <div class="card">
      <h4>Prueba de Hip√≥tesis ‚Äî Media (t-test)</h4>

      <label class="mt-2">Columna num√©rica</label>
      <select id="ttest_col" class="form-select"></select>

      <label class="mt-2">Media poblacional (Œº‚ÇÄ)</label>
      <input id="ttest_mu0" type="number" class="form-control" placeholder="Ej. 5000">

      <label class="mt-2">Nivel de confianza</label>
      <select id="ttest_alpha" class="form-select">
          <option value="0.10">90%</option>
          <option value="0.05" selected>95%</option>
          <option value="0.01">99%</option>
      </select>

      <button class="btn btn-success mt-3 w-100" onclick="calcTTest()">Calcular prueba t</button>

      <div id="ttest_result" class="mt-3"></div>
      <canvas id="chartTTest" class="mt-3"></canvas>
    </div>

    <!-- CARD 5 - Intervalo de confianza -->
    <div class="card">
      <h4>Intervalo de Confianza ‚Äî Media</h4>

      <label class="mt-2">Columna num√©rica</label>
      <select id="ic_col" class="form-select"></select>

      <label class="mt-2">Nivel de confianza</label>
      <select id="ic_level" class="form-select">
          <option value="0.10">90%</option>
          <option value="0.05" selected>95%</option>
          <option value="0.01">99%</option>
      </select>

      <label class="muted small mt-3">Par√°metro</label>
      <select id="ic_param" class="form-select">
          <option value="media" selected>Media</option>
          <option value="sd">Desviaci√≥n est√°ndar</option>
      </select>

      <button class="btn btn-primary mt-3" onclick="calcIC()">Calcular</button>

      <div id="ic_result" class="mt-3"></div>

      <label class="muted small mt-3">Tipo de gr√°fico</label>
      <select id="ic_chart_type" class="form-select">
          <option value="bar">Barras</option>
          <option value="points">L√≠nea con puntos</option>
      </select>

      <canvas id="chartIC" class="mt-3"></canvas>
    </div>

  </div>
</section>




  <!-- =================  PRODUCCI√ìN VIEW  ====================== -->
  <section id="view-produccion" class="view-pane hidden">

    <div class="grid grid-2">

      <!-- ---- CONTROLES ---- -->
      <div class="card">
        <h4>Control de Producci√≥n</h4>

        <div class="mt-2">
          <label class="muted small">Variable de producci√≥n</label>
          <select id="selectProdVar" class="form-select"></select>
        </div>

        <div class="mt-3" style="display:flex; gap:8px;">
          <button id="btnLoadProd" class="btn btn-primary w-100">Cargar Producci√≥n</button>
          <button id="btnClearProd" class="btn btn-outline-light w-100">Limpiar</button>
        </div>

        <div id="prodResumen" class="mt-3 muted">Sin datos.</div>
      </div>

      <!-- ---- TABLA ---- -->
      <div class="card">
        <h5>Registros de Producci√≥n</h5>
        <table class="table table-dark table-striped mt-2">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Operario</th>
              <th>Unidades</th>
            </tr>
          </thead>
          <tbody id="prodTable"></tbody>
        </table>
      </div>

    </div>

  </section>



  <!-- ===================  OPERARIO VIEW  ====================== -->
  <section id="view-operario" class="view-pane hidden">

    <div class="grid grid-2">

      <div class="card">
        <h4>Registro del Operario</h4>

        <div class="mt-2">
          <label class="muted small">Nombre del operario</label>
          <input id="opNombre" type="text" class="form-control" placeholder="Ingresa tu nombre">
        </div>

        <div class="mt-2">
          <label class="muted small">Turno</label>
          <select id="opTurno" class="form-select">
            <option value="Ma√±ana">Ma√±ana</option>
            <option value="Tarde">Tarde</option>
            <option value="Noche">Noche</option>
          </select>
        </div>

        <div class="mt-3" style="display:flex; gap:8px;">
          <button id="btnMarcarEntrada" class="btn btn-success w-100">Registrar Entrada</button>
          <button id="btnMarcarSalida" class="btn btn-danger w-100">Registrar Salida</button>
        </div>
      </div>

      <div class="card">
        <h5>Historial</h5>
        <div id="operarioLog" class="muted small">
          Sin registros.
        </div>
      </div>

    </div>

  </section>

</section>

      
  <!-- ==================   MODELOS VIEW   ====================== -->
  <section id="view-modelos" class="view-pane hidden">

    <div class="grid grid-2">

      <!-- ---- ANALISIS ANOVA / REGRESI√ìN / CORRELACI√ìN ---- -->
      <div class="card">
        <h4>Modelos Estad√≠sticos</h4>
        <!-- Caja de mensajes elegante -->
        <div id="msgBox" class="alert alert-info mt-2" style="display:none;"></div>
        <div class="muted small mt-2">Variables disponibles</div>
        <select id="selectModelVar" class="form-select mt-2"></select>
        <div class="muted small mt-3">Grupo (ANOVA)</div>
        <select id="selectModelGroup" class="form-select mt-2"></select>  

        <div class="muted small mt-3">Variable X (Regresi√≥n / Correlaci√≥n)</div>
        <select id="selectModelX" class="form-select mt-2"></select>

        <div class="muted small mt-3">Variable Y (Regresi√≥n / Correlaci√≥n)</div>
        <select id="selectModelY" class="form-select mt-2"></select>

        <div class="mt-3" style="display:flex; gap:8px;">
          <button id="btnRegresion" class="btn btn-primary w-100">Regresi√≥n Lineal</button>
          <button id="btnCorrelacion" class="btn btn-outline-light w-100">Correlaci√≥n</button>
        </div>

        <div class="mt-3">
          <button id="btnANOVA" class="btn btn-warning w-100">ANOVA</button>
        </div>

        <div id="modelResults" class="mt-3 muted">
          Sin resultados.  
        </div>
      </div>

      <!-- ---- BINOMIAL (MODELOS) ---- -->
      <div class="card">
        <h4>Distribuci√≥n Binomial</h4>

        <div class="mt-2">
          <label class="muted small">n (ensayos)</label>
          <input id="inputBinN" type="number" class="form-control" value="10">
        </div>

        <div class="mt-2">
          <label class="muted small">p (probabilidad)</label>
          <input id="inputBinP" type="number" class="form-control" step="0.01" value="0.5">
        </div>

        <div class="mt-2">
          <label class="muted small">k (√©xitos)</label>
          <input id="inputBinK" type="number" class="form-control" value="5">
        </div>

        <button id="btnCalcBinomial" class="btn btn-primary mt-3 w-100">
          Calcular Binomial
        </button>

        <div class="mt-3">
          <canvas id="chartBinomialModels"></canvas>
        <div id="binomialModelsOutput" class="mt-3 muted">
        </div>
        </div>
      </div>
      
           <!-- ---- POISSON (MODELOS) ---- -->
    <div class="card">
      <h4>Distribuci√≥n Poisson</h4>

      <div class="mt-2">
        <label class="muted small">Œª (media)</label>
        <input id="inputPoissonLambda" type="number" class="form-control" value="5">
      </div>

      <div class="mt-2">
        <label class="muted small">k (eventos)</label>
        <input id="inputPoissonK" type="number" class="form-control" value="2">
      </div>

      <button id="btnCalcPoisson" class="btn btn-primary mt-3 w-100">
        Calcular Poisson
      </button>

      <div class="mt-3">
        <canvas id="chartPoisson"></canvas>
        <div id="poissonOutput" class="mt-3 muted"></div>
      </div>

      <div class="mt-2">
        <label class="muted small">Tipo de gr√°fico</label>
        <select id="poissonChartType" class="form-select">
          <option value="bar" selected>Barras</option>
          <option value="line">L√≠nea con puntos</option>
        </select>
      </div>   
    </div>
          <!-- ======== DISTRIBUCI√ìN NORMAL ======== -->
    <div class="card chart-card mt-4">
      <h4 class="muted">Distribuci√≥n Normal</h4>

      <div class="mt-2">
        <label class="muted small">Media (Œº)</label>
        <input id="normalMu" type="number" class="form-control">
      </div>

      <div class="mt-2">
        <label class="muted small">Desviaci√≥n (œÉ)</label>
        <input id="normalSigma" type="number" step="0.01" class="form-control">
      </div>

      <div class="mt-2">
        <label class="muted small">L√≠mite inferior (a)</label>
        <input id="normalA" type="number" class="form-control">
      </div>

      <div class="mt-2">
        <label class="muted small">L√≠mite superior (b)</label>
        <input id="normalB" type="number" class="form-control">
      </div>

      <div class="mt-3">
        <label class="muted small">Tipo de gr√°fico</label>
        <select id="normalChartType" class="form-select">
          <option value="line">L√≠nea</option>
          <option value="bar">Barras</option>
        </select>
      </div>

      <button class="btn btn-primary mt-3 w-100" onclick="postNormal()">
        Calcular Normal
      </button>

      <div id="normalResults" class="mt-3 muted"></div>
      
      <canvas id="chartNormal" class="mt-3 normal-chart"></canvas>
    </div>

  </section>
      <footer class="app-footer">
        Proyecto escolar ‚Äî F√°brica Alfa ¬∑ Equipo de Ingenier√≠a
      </footer>
    </main>
  </div>

  <!-- Login fullscreen (simple) -->
  <div id="loginModal" class="login-modal hidden">
    <div class="login-card">
      <h3>Iniciar sesi√≥n</h3>
      <input id="loginUser" class="form-control mt-2" placeholder="Usuario (admin / supervisor / operario)">
      <input id="loginPass" type="password" class="form-control mt-2" placeholder="Contrase√±a">
      <div style="display:flex; gap:8px; margin-top:12px;">
        <button id="loginBtn" class="btn btn-primary">Entrar</button>
        <button id="loginClose" class="btn btn-outline-light">Cerrar</button>
      </div>
      <div id="loginMsg" class="muted mt-2"></div>
    </div>
  </div>

  <!-- Enlazamos el JS (app.js) -->
  <script src="/web/app.js"></script>

</body>
</html>
